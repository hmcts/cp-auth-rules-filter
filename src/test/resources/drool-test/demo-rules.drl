package uk.gov.moj.cpp.authz.demo;

import uk.gov.moj.cpp.authz.drools.Outcome;
import uk.gov.moj.cpp.authz.drools.Action;

global uk.gov.moj.cpp.authz.http.providers.UserAndGroupProvider userAndGroupProvider;

// --- Route-based actions ---

rule "Allow GET /api/hello for LA or PA"
when
  $o: Outcome()
  $a: Action(name == "GET /api/hello")
  eval(userAndGroupProvider.isMemberOfAnyOfTheSuppliedGroups($a, "Legal Advisers", "Prosecuting Authority Access"))
then
  $o.setSuccess(true);
end

rule "Allow POST /api/echo for LA"
when
  $o: Outcome()
  $a: Action(name == "POST /api/echo")
  eval(userAndGroupProvider.isMemberOfAnyOfTheSuppliedGroups($a, "Legal Advisers"))
then
  $o.setSuccess(true);
end

// --- Vendor-style actions resolved from Content-Type / Accept ---

rule "Allow sjp.delete-financial-means for LA"
when
  $o: Outcome()
  $a: Action(name == "sjp.delete-financial-means")
  eval(userAndGroupProvider.isMemberOfAnyOfTheSuppliedGroups($a, "Legal Advisers")) and
  eval(userAndGroupProvider.hasPermission($a, "{\"object\":\"sjp-financial-means\",\"action\":\"Delete\"}"))
then
  $o.setSuccess(true);
end

rule "Allow hearing.get-draft-result for LA"
when
  $o: Outcome()
  $a: Action(name == "hearing.get-draft-result")
  eval(userAndGroupProvider.isMemberOfAnyOfTheSuppliedGroups($a, "Legal Advisers")) or
  eval(userAndGroupProvider.hasPermission($a, "{\"object\":\"draft-result\",\"action\":\"View\"}"))
then
  $o.setSuccess(true);
end
